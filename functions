// –ü–æ–∫–∞–∑–∞—Ç—å —É –∫–æ–≥–æ –î–† —Å–µ–≥–æ–¥–Ω—è

function showTodayBirthday(chat_id) {
  var lastRow = sortList.getLastRow();
  var range = sortList.getRange(2, 1, lastRow - 1, 4);  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö A, B, C, D
  var data = range.getValues();

  var today = new Date();
  var todayMonth = today.getMonth();
  var todayDate = today.getDate();
  
  var hasBirthdayToday = false; // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –≤ false
  
  for (var i = 0; i < data.length; i++) {
    var birthday = data[i][1];
    var birthdayMonth = birthday.getMonth();
    var birthdayDate = birthday.getDate();
    let comment = (data[i][2].length > 0) ? ("\n\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: " + data[i][2]) : "";
    let username = (data[i][3].length > 0) ? (data[i][3]) : "";


    if (todayMonth === birthdayMonth && todayDate === birthdayDate) {
    var name = data[i][0];  
    var message = "üéâ –Æ—Ö—É—É—É! –°–µ–≥–æ–¥–Ω—è —Å–≤–æ–π –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –ø—Ä–∞–∑–¥–Ω—É–µ—Ç " + name + ". " + username + "\n\n–ù–∞–ø—Ä–∞–≤–ª—è–µ–º —Å–≤–æ–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è !" + comment ;
      
    sendMessage(chat_id,message);
    hasBirthdayToday = true; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥, —á—Ç–æ –±—ã–ª –Ω–∞–π–¥–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è
    }
  }
   
   if (!hasBirthdayToday) { // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è
   var Xmessage = "üòì –û–±—ã—á–Ω—ã–π –¥–µ–Ω—å, –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–∞–∑–¥–Ω—É–µ—Ç –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è.";
   sendMessage(chat_id, Xmessage)
  } 
}


// –ü–æ–∫–∞–∑–∞—Ç—å —É –∫–æ–≥–æ –î–† –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ

function showMonthBirthdays(chat_id) {
  var lastRow = sortList.getLastRow();
  var range = sortList.getRange(2, 1, lastRow - 1, 4);  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö A, B, C, D
  var data = range.getValues();
  var today = new Date();
  var currentMonth = today.getMonth();
  var birthdays = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è
  var hasBirthdayMounth = false; // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –≤ false
  
  for (var i = 0; i < data.length; i++) {
    var name = data[i][0]; 
    var birthday = data[i][1];
    var birthdayMonth = birthday.getMonth();
    var birthdayDate = birthday.getDate();
  if (birthdayMonth === currentMonth) {
    birthdays.push(birthdayDate + " " + getMonthName(birthdayMonth, 0) + " ‚Äî " + name); // –î–æ–±–∞–≤–∏—Ç—å –∏–º—è –∏ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤
    }
    
  }
  
  if (birthdays.length > 0) {
        var message = "üî∏ –î–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ " + getMonthName(currentMonth, 2) + ":\n\n" + birthdays.join("\n"); // –°–æ–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–º–µ–Ω–∏ –∏ –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏–π

    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram-–±–æ—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è API Bot
    sendMessage(chat_id, message);
    hasBirthdayMounth = true; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥, —á—Ç–æ –±—ã–ª –Ω–∞–π–¥–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è
  }

  if (!hasBirthdayMounth) { // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è
    var Xmessage = "üòì –û–±—ã—á–Ω—ã–π –º–µ—Å—è—Ü, –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–∞–∑–¥–Ω—É–µ—Ç –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è.";
    sendMessage(chat_id, Xmessage)
  }
}


// –ü–æ–∫–∞–∑–∞—Ç—å —É –∫–æ–≥–æ –î–† –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ

function showNextMonthBirthdays(chat_id) {
  var lastRow = sortList.getLastRow();
  var range = sortList.getRange(2, 1, lastRow - 1, 4);  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö A, B, C, D
  var data = range.getValues();
  var today = new Date();
  var nextMonth = today.getMonth() + 1;

  var birthdays = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è
  var hasBirthdayMounth = false; // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –≤ false
  
  for (var i = 0; i < data.length; i++) {
    var name = data[i][0]; 
    var birthday = data[i][1];
    var birthdayMonth = birthday.getMonth();
    var birthdayDate = birthday.getDate();
    
    if (birthdayMonth === nextMonth) {
    birthdays.push(birthdayDate + " " + getMonthName(birthdayMonth, 0) + " ‚Äî " + name); // –î–æ–±–∞–≤–∏—Ç—å –∏–º—è –∏ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤
    }
    
  }

  if (birthdays.length > 0) {
    var message = "üî∏ –î–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ " + getMonthName(nextMonth, 2) + ":\n\n" + birthdays.join("\n"); // –°–æ–±—Ä–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–º–µ–Ω–∏ –∏ –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏–π

    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram-–±–æ—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è API Bot
    sendMessage(chat_id, message);
    hasBirthdayMounth = true; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥, —á—Ç–æ –±—ã–ª –Ω–∞–π–¥–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è
  }

  if (!hasBirthdayMounth) { // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è
    var Xmessage = "üòì –ë—É–¥–µ—Ç –æ–±—ã—á–Ω—ã–π –º–µ—Å—è—Ü, –±–µ–∑ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤.";
    sendMessage(chat_id, Xmessage)
  }
}


// –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –î–† –≤ –≥–æ–¥—É

function showYear(chat_id) {
  var lastRow = sortList.getLastRow();
  var range = sortList.getRange(2, 1, lastRow - 1, 4);  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö A, B, C, D
    
  var data = range.getValues();
  var message = "üî∏ –í—Å–µ –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ –≥–æ–¥—É:\n\n";
  var birthdaysByMonth = {};

  for (var i = 0; i < data.length; i++) {
    var name = data[i][0]; 
    var birthday = data[i][1];
    var birthdayMonth = birthday.getMonth();
    var birthdayDate = birthday.getDate();

    if (!birthdaysByMonth[birthdayMonth]) {
      birthdaysByMonth[birthdayMonth] = [];
    }
    
    birthdaysByMonth[birthdayMonth].push(birthdayDate + " " + getMonthName(birthdayMonth, 0) +  " ‚Äì " + name);
  }
  
  for (var month in birthdaysByMonth) {
    message += "üóì " + getMonthName(month,1) + ":\n\n";
    message += birthdaysByMonth[month].join("\n") + "\n\n\n";
  }

  
  sendMessage(chat_id, message);
}


// –ù–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–µ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

function getMonthName(monthIndex, format) {
  var months = [
    ["—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è", "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"],
    ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"],
    ["—è–Ω–≤–∞—Ä–µ", "—Ñ–µ–≤—Ä–∞–ª–µ", "–º–∞—Ä—Ç–µ", "–∞–ø—Ä–µ–ª–µ", "–º–∞–µ", "–∏—é–Ω–µ", "–∏—é–ª–µ", "–∞–≤–≥—É—Å—Ç–µ", "—Å–µ–Ω—Ç—è–±—Ä–µ", "–æ–∫—Ç—è–±—Ä–µ", "–Ω–æ—è–±—Ä–µ", "–¥–µ–∫–∞–±—Ä–µ"]
  ];

  return months[format][monthIndex];
}
